# 项目架构说明

## 整体架构

项目采用四层架构设计，从底层到顶层依次为：

```
Framework (框架层)
    ↓
Common (通用层)
    ↓
Type (类型玩法层)
    ↓
SpecGame (特定游戏层)
```

## 层级说明

### 1. Framework 层
**位置**: `Assets/Scripts/Framework/`

**职责**: 
- 提供核心框架功能和基础设施
- 模块系统 (ModuleSystem)
- 事件总线 (EventBus)
- 服务架构 (Services)
- 渲染配置 (Rendering)

**命名空间**: `PVZ.Framework.*`

**依赖**: Unity Engine, DOTS

### 2. Common 层
**位置**: `Assets/Scripts/Common/`

**职责**:
- 所有游戏类型共享的通用代码
- 基础组件（Health, View, Grid 等）
- 通用系统（ViewLoader, HealthBar 等）
- 通用模块（EventBus, Services, Rendering）

**命名空间**: `PVZ.Common.*`

**依赖**: Framework

**详细文档**: [Common/README.md](Common/README.md)

### 3. Type 层
**位置**: `Assets/Scripts/Type/`

**职责**:
- 特定游戏类型的通用机制
- 当前包含 TowerDefense（塔防）类型
- 子弹系统、攻击系统、关卡管理等塔防通用功能

**命名空间**: `PVZ.Type.*`

**依赖**: Framework, Common

**详细文档**: [Type/TowerDefense/README.md](Type/TowerDefense/README.md)

### 4. SpecGame 层
**位置**: `Assets/Scripts/SpecGame/`

**职责**:
- 特定游戏的具体实现
- 当前包含 PVE（植物大战僵尸）游戏
- 植物、僵尸、阳光系统等 PVZ 特定功能
- 游戏配置、数据、UI

**命名空间**: `PVZ.SpecGame.*`

**依赖**: Framework, Common, Type

**详细文档**: [SpecGame/PVE/README.md](SpecGame/PVE/README.md)

## 依赖规则

### 允许的依赖方向
- ✅ SpecGame → Type → Common → Framework
- ✅ 同层级的不同子目录可以互相依赖（需评估）

### 禁止的依赖方向
- ❌ Framework → Common
- ❌ Common → Type
- ❌ Type → SpecGame

## 代码组织原则

### 1. 单一职责
每一层只负责其对应抽象级别的功能

### 2. 向下依赖
高层级可以依赖低层级，低层级不能依赖高层级

### 3. 可复用性
- Common: 适用于所有游戏类型
- Type: 适用于同类型的不同游戏
- SpecGame: 特定游戏的独特实现

### 4. 配置驱动
通过配置而非硬编码来定制行为，提高灵活性

## 添加新功能的指南

### 添加通用功能
1. 判断是否适用于所有游戏 → 放入 Common
2. 判断是否适用于特定游戏类型 → 放入 Type
3. 仅适用于特定游戏 → 放入 SpecGame

### 添加新游戏类型
1. 在 `Type/` 下创建新目录（如 `Type/RTS/`）
2. 实现该类型特有的 Components, Systems, Modules
3. 复用 Common 层的通用功能

### 添加新游戏
1. 在 `SpecGame/` 下创建新目录（如 `SpecGame/PVP/`）
2. 实现游戏特定的逻辑和数据
3. 复用 Type 层的玩法机制
4. 复用 Common 层的通用功能

## 命名空间规范

```csharp
// Framework
namespace PVZ
namespace PVZ

// Common
namespace PVZ
namespace PVZ
namespace PVZ

// Type
namespace PVZ
namespace PVZ

// SpecGame
namespace PVZ
namespace PVZ
namespace PVZ
```

## 迁移记录

### 2024 架构重构
- 从 `Game/` 单一目录重构为四层架构
- 组件命名空间：`PVZ.DOTS.Components` → 按层级分离
- 系统命名空间：`PVZ.DOTS.Systems` → 按层级分离
- 模块命名空间：`PVZ.Game.Modules` → `PVZ.Common.Modules` / `PVZ.SpecGame.PVE.Modules`

### 重构成果
- ✅ 53 个文件完成命名空间更新
- ✅ 清晰的依赖关系
- ✅ 更好的代码复用性
- ✅ 支持多游戏/多类型扩展
