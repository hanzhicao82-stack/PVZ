# åŠ¨ç”»çƒ˜ç„™å·¥å…·ä½¿ç”¨æŒ‡å—

## ğŸ“š åŠŸèƒ½è¯´æ˜

åŠ¨ç”»çƒ˜ç„™å·¥å…·å¯ä»¥å°† Unity Animation Clip çƒ˜ç„™åˆ°è´´å›¾ï¼ˆTextureï¼‰ä¸­ï¼Œç”¨äºå®ç°é«˜æ€§èƒ½çš„ GPU åŠ¨ç”»ï¼ˆVertex Animation Texture, VATï¼‰ã€‚

### ä¼˜åŠ¿

- âœ… **æ€§èƒ½æé«˜**ï¼šåŠ¨ç”»è®¡ç®—åœ¨ GPU ä¸Šå¹¶è¡Œæ‰§è¡Œ
- âœ… **æ”¯æŒå¤§é‡å®ä¾‹**ï¼šå¯ä»¥åŒæ—¶æ’­æ”¾æˆåƒä¸Šä¸‡ä¸ªåŠ¨ç”»è§’è‰²
- âœ… **æ— éª¨éª¼å¼€é”€**ï¼šä¸éœ€è¦ SkinnedMeshRenderer å’Œéª¨éª¼ç³»ç»Ÿ
- âœ… **å†…å­˜å‹å¥½**ï¼šæ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€å¥—è´´å›¾æ•°æ®

### é€‚ç”¨åœºæ™¯

- å¤§é‡é‡å¤è§’è‰²ï¼ˆå¦‚åƒµå°¸ç¾¤ã€å£«å…µç¾¤ï¼‰
- ç®€å•åŠ¨ç”»æ•ˆæœï¼ˆèµ°è·¯ã€æ”»å‡»ç­‰ï¼‰
- æ€§èƒ½ä¼˜å…ˆçš„ç§»åŠ¨ç«¯æ¸¸æˆ
- ç²’å­ç³»ç»Ÿä¸­çš„åŠ¨ç”»æ¨¡å‹

---

## ğŸ”§ ä½¿ç”¨æ­¥éª¤

### 1. æ‰“å¼€å·¥å…·çª—å£

```
Unity èœå• â†’ Tools â†’ Animation Baker
```

### 2. è®¾ç½®è¾“å…¥

- **ç›®æ ‡é¢„åˆ¶ä½“**ï¼šåŒ…å« SkinnedMeshRenderer çš„è§’è‰²é¢„åˆ¶ä½“
- **åŠ¨ç”»ç‰‡æ®µ**ï¼šè¦çƒ˜ç„™çš„ AnimationClip

### 3. é…ç½®å‚æ•°

- **é‡‡æ ·å¸§ç‡**ï¼šå»ºè®® 30 FPSï¼ˆå¹³è¡¡è´¨é‡å’Œæ–‡ä»¶å¤§å°ï¼‰
- **è´´å›¾å®½åº¦**ï¼šè®¾ç½®ä¸ºç½‘æ ¼é¡¶ç‚¹æ•°ï¼ˆå·¥å…·ä¼šè‡ªåŠ¨æç¤ºï¼‰
- **è´´å›¾é«˜åº¦**ï¼šè®¾ç½®ä¸ºåŠ¨ç”»æ€»å¸§æ•°

### 4. è®¾ç½®è¾“å‡ºè·¯å¾„

- ç‚¹å‡»"æµè§ˆ"æŒ‰é’®é€‰æ‹©è¾“å‡ºæ–‡ä»¶å¤¹
- è®¾ç½®è¾“å‡ºæ–‡ä»¶åå‰ç¼€

### 5. çƒ˜ç„™

ç‚¹å‡»"çƒ˜ç„™åŠ¨ç”»åˆ°è´´å›¾"æŒ‰é’®ï¼Œç­‰å¾…å¤„ç†å®Œæˆã€‚

---

## ğŸ“¦ è¾“å‡ºæ–‡ä»¶

çƒ˜ç„™å®Œæˆåä¼šç”Ÿæˆ 3 ä¸ªæ–‡ä»¶ï¼š

### 1. `*_PositionMap.exr`
- **å†…å®¹**ï¼šæ¯ä¸ªé¡¶ç‚¹åœ¨æ¯ä¸€å¸§çš„ä¸–ç•Œåæ ‡
- **æ ¼å¼**ï¼šEXR æµ®ç‚¹è´´å›¾ï¼ˆRGB = XYZï¼‰
- **å°ºå¯¸**ï¼šå®½åº¦ = é¡¶ç‚¹æ•°ï¼Œé«˜åº¦ = å¸§æ•°

### 2. `*_NormalMap.exr`
- **å†…å®¹**ï¼šæ¯ä¸ªé¡¶ç‚¹åœ¨æ¯ä¸€å¸§çš„æ³•çº¿æ–¹å‘
- **æ ¼å¼**ï¼šEXR æµ®ç‚¹è´´å›¾ï¼ˆRGB = æ³•çº¿ XYZï¼‰

### 3. `*_BakeData.asset`
- **å†…å®¹**ï¼šåŠ¨ç”»å…ƒæ•°æ®ï¼ˆå¸§ç‡ã€æ€»å¸§æ•°ã€æ—¶é•¿ç­‰ï¼‰
- **ç±»å‹**ï¼šScriptableObject

---

## ğŸ® ä½¿ç”¨çƒ˜ç„™çš„åŠ¨ç”»

### æ–¹æ³• 1ï¼šä½¿ç”¨ BakedAnimationPlayer ç»„ä»¶

1. åˆ›å»ºä¸€ä¸ªå¸¦ MeshRenderer çš„ GameObject
2. æ·»åŠ  `BakedAnimationPlayer` ç»„ä»¶
3. è®¾ç½®çƒ˜ç„™æ•°æ®ï¼š
   - æ‹–æ‹½ `*_BakeData.asset` åˆ° Bake Data å­—æ®µ
4. è®¾ç½®æè´¨ï¼š
   - ä½¿ç”¨ `BakedAnimationShader` æè´¨
5. è¿è¡Œæ¸¸æˆï¼ŒåŠ¨ç”»è‡ªåŠ¨æ’­æ”¾

### æ–¹æ³• 2ï¼šæ‰‹åŠ¨è®¾ç½® Shader

```csharp
Material material = renderer.material;
material.SetTexture("_PositionMap", positionMap);
material.SetTexture("_NormalMap", normalMap);
material.SetFloat("_FrameRate", 30f);
material.SetInt("_TotalFrames", 60);

// åœ¨ Update ä¸­æ›´æ–°æ—¶é—´
material.SetFloat("_AnimationTime", Time.time);
```

---

## ğŸ¨ Shader è¯´æ˜

### å†…ç½® Shader å‚æ•°

```shader
_MainTex          // ä¸»çº¹ç†ï¼ˆé¢œè‰²è´´å›¾ï¼‰
_PositionMap      // ä½ç½®è´´å›¾ï¼ˆçƒ˜ç„™ç”Ÿæˆï¼‰
_NormalMap        // æ³•çº¿è´´å›¾ï¼ˆçƒ˜ç„™ç”Ÿæˆï¼‰
_AnimationTime    // å½“å‰åŠ¨ç”»æ—¶é—´ï¼ˆç§’ï¼‰
_FrameRate        // å¸§ç‡ï¼ˆå¦‚ 30ï¼‰
_TotalFrames      // æ€»å¸§æ•°ï¼ˆå¦‚ 60ï¼‰
```

### å·¥ä½œåŸç†

1. Vertex Shader æ ¹æ® `_AnimationTime` è®¡ç®—å½“å‰å¸§
2. ä» `_PositionMap` è¯»å–é¡¶ç‚¹ä½ç½®
3. ä» `_NormalMap` è¯»å–æ³•çº¿æ–¹å‘
4. åœ¨ç›¸é‚»ä¸¤å¸§ä¹‹é—´è¿›è¡Œæ’å€¼ï¼Œå®ç°å¹³æ»‘è¿‡æ¸¡

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹å¼ | CPU å¼€é”€ | GPU å¼€é”€ | 1000 ä¸ªè§’è‰² |
|------|----------|----------|------------|
| **SkinnedMeshRenderer** | é«˜ï¼ˆéª¨éª¼è®¡ç®—ï¼‰ | ä½ | 10-20 FPS |
| **GPU åŠ¨ç”»ï¼ˆVATï¼‰** | æä½ | ä¸­ç­‰ | **60 FPS** |

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. é™ä½è´´å›¾å°ºå¯¸

- é¡¶ç‚¹æ•°å¤šçš„æ¨¡å‹å¯ä»¥ä½¿ç”¨ LOD ç®€åŒ–
- å¸§ç‡å¯ä»¥é™ä½åˆ° 20-24 FPS

### 2. å‹ç¼©è´´å›¾

```csharp
// è®¾ç½®è´´å›¾å¯¼å…¥è®¾ç½®
TextureImporter importer = AssetImporter.GetAtPath(path) as TextureImporter;
importer.textureCompression = TextureImporterCompression.Compressed;
importer.SaveAndReimport();
```

### 3. æ‰¹é‡çƒ˜ç„™

å¯ä»¥æ‰¹é‡å¤„ç†å¤šä¸ªåŠ¨ç”»ç‰‡æ®µï¼š

```csharp
foreach (var clip in animationClips)
{
    BakeAnimation(prefab, clip, outputPath);
}
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šçƒ˜ç„™åæ¨¡å‹å˜å½¢

**åŸå› **ï¼šé¡¶ç‚¹æ•°è¶…è¿‡è´´å›¾å®½åº¦

**è§£å†³**ï¼š
```csharp
textureWidth = mesh.vertexCount; // è®¾ç½®ä¸ºé¡¶ç‚¹æ•°
```

### é—®é¢˜ï¼šåŠ¨ç”»æ’­æ”¾é€Ÿåº¦ä¸å¯¹

**åŸå› **ï¼šå¸§ç‡è®¾ç½®é”™è¯¯

**è§£å†³**ï¼š
```csharp
material.SetFloat("_FrameRate", bakeData.frameRate); // ä½¿ç”¨æ­£ç¡®å¸§ç‡
```

### é—®é¢˜ï¼šæ³•çº¿æ˜¾ç¤ºå¼‚å¸¸

**åŸå› **ï¼šæ³•çº¿æœªæ­£ç¡®ç¼–ç 

**è§£å†³**ï¼šæ£€æŸ¥ Shader ä¸­æ³•çº¿è§£ç ï¼š
```shader
normal = normal * 2.0 - 1.0; // [0,1] â†’ [-1,1]
```

---

## ğŸš€ é«˜çº§ç”¨æ³•

### æ··åˆå¤šä¸ªåŠ¨ç”»

```shader
// Shader ä¸­æ··åˆä¸¤ä¸ªåŠ¨ç”»
float3 pos1 = SamplePositionMap(posMap1, uv, frame1);
float3 pos2 = SamplePositionMap(posMap2, uv, frame2);
float3 finalPos = lerp(pos1, pos2, blendWeight);
```

### å®ä¾‹åŒ–æ¸²æŸ“

```csharp
// ä½¿ç”¨ GPU Instancing æ¸²æŸ“ 10000 ä¸ªè§’è‰²
Graphics.DrawMeshInstanced(
    mesh, 
    0, 
    material, 
    matrices, // 10000 ä¸ªå˜æ¢çŸ©é˜µ
    10000
);
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä»…æ”¯æŒ SkinnedMeshRenderer**ï¼šé™æ€ç½‘æ ¼æ— éœ€çƒ˜ç„™
2. **EXR æ ¼å¼å¿…éœ€**ï¼šPNG/JPG æ— æ³•å­˜å‚¨æµ®ç‚¹æ•°æ®
3. **è´´å›¾å°ºå¯¸é™åˆ¶**ï¼šæœ€å¤§ 8192Ã—8192ï¼ˆå— GPU é™åˆ¶ï¼‰
4. **å†…å­˜æ¶ˆè€—**ï¼šEXR è´´å›¾è¾ƒå¤§ï¼Œæ³¨æ„èµ„æºç®¡ç†

---

## ğŸ¯ ç¤ºä¾‹åœºæ™¯

æŸ¥çœ‹ç¤ºä¾‹åœºæ™¯ï¼š`Examples/BakedAnimationExample.unity`

åŒ…å«ï¼š
- å•ä¸ªè§’è‰²æ’­æ”¾
- æ‰¹é‡å®ä¾‹åŒ–
- æ€§èƒ½å¯¹æ¯”æµ‹è¯•

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Unity VAT æ–‡æ¡£](https://docs.unity3d.com/Manual/)
- [GPU åŠ¨ç”»æŠ€æœ¯](https://simonschreibt.de/gat/renderhell-book1/)
- [Houdini VAT Export](https://www.sidefx.com/docs/houdini/)
